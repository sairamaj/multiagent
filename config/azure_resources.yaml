# Azure Resource Configuration
# This file contains VM naming patterns and cleanup policies

vm_naming_patterns:
  # CI Template VMs
  ci_templates:
    description: "CI build template virtual machines"
    pattern: "vhds-ci-wat-template-{release}.{release_type}-{timestamp}"
    regex: "^vhds-ci-wat-template-\\d+-\\d+-\\d+\\.(beta|rc|release)-\\d{14}$"
    examples:
      - "vhds-ci-wat-template-26-1-0.beta-20260213025457"
      - "vhds-ci-wat-template-25-2-1.release-20260115103022"
      - "vhds-ci-wat-template-24-3-5.rc-20251220143015"
    
  # Production VMs
  production:
    description: "Production virtual machines"
    pattern: "vhds-prod-{app}-{version}"
    regex: "^vhds-prod-[a-z]+-\\d+\\.\\d+\\.\\d+$"
    examples:
      - "vhds-prod-api-1.2.3"
      - "vhds-prod-web-2.0.1"
  
  # Staging VMs
  staging:
    description: "Staging environment VMs"
    pattern: "vhds-stg-{app}-{version}"
    regex: "^vhds-stg-[a-z]+-\\d+\\.\\d+\\.\\d+$"
    examples:
      - "vhds-stg-api-1.2.3"
      - "vhds-stg-web-2.0.1"

# VM Cleanup Policies
vm_cleanup:
  # Keep the latest N VMs matching the pattern
  keep_latest_count: 5
  
  # Delete VMs older than this many days
  age_threshold_days: 30
  
  # Tags to exclude from cleanup (VMs with these tags won't be deleted)
  exclude_tags:
    - "permanent"
    - "production"
    - "do-not-delete"
  
  # Require confirmation for destructive operations
  require_confirmation: true
  
  # Dry run mode - log what would be deleted without actually deleting
  dry_run: false

# Resource Group Configuration
resource_groups:
  ci_resources:
    name: "rg-ci-templates"
    location: "eastus"
    allowed_vm_patterns:
      - "ci_templates"
  
  production_resources:
    name: "rg-production"
    location: "eastus"
    allowed_vm_patterns:
      - "production"
  
  staging_resources:
    name: "rg-staging"
    location: "eastus"
    allowed_vm_patterns:
      - "staging"

# VM Size and Cost Monitoring
vm_monitoring:
  # Alert if VM has been running longer than this (in hours)
  max_runtime_hours: 168  # 7 days
  
  # Alert if VM CPU usage is above this percentage
  cpu_threshold_percent: 80
  
  # Alert if VM memory usage is above this percentage
  memory_threshold_percent: 85
  
  # Check interval in minutes
  check_interval_minutes: 15
